#!/usr/bin/python3

from elasticsearch import Elasticsearch
# Connect to Elasticsearch
es = Elasticsearch('https://localhost:9200',basic_auth=('elastic', 'password'),ca_certs='/<path>/'
)

# Define the query to filter documents with "vuln.id" field
query = {"size": 10000, "query": {"exists": {"field": "vuln.id"}},"aggs": {"dc": {"cardinality": {"field": "vuln.id"}}}}
# Execute the search
result = es.search(index="rss-feed", body=query)
# Extract the values of "vuln.id" from the search results
vuln_ids = [hit["_source"]["vuln"]["id"] for hit in result["hits"]["hits"]]
# Define the path and name of the output file
output_file = "/etc/logstash/cvss/cve-list.txt"
# Write the values to the output file
with open(output_file, "w") as file:
  for vuln_id in vuln_ids:
    file.write(vuln_id + "\n")
print("Output saved to", output_file)